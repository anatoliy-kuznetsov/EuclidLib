Sets
i Steiner points / 1*48 /
j terminals / 1*50 /
k dimensions / 1*3 /;
Alias(i,ii);
Parameters terminals(j,k);
terminals('1', '1') = 0.823807241964088; terminals('1', '2') = 0.895209158949168; terminals('1', '3') = 0.18786841055338477; 
terminals('2', '1') = 0.3038589716866532; terminals('2', '2') = 0.4782984565594395; terminals('2', '3') = 0.1629042284197154; 
terminals('3', '1') = 0.09176496297891834; terminals('3', '2') = 0.744110280968943; terminals('3', '3') = 0.3329784369562603; 
terminals('4', '1') = 0.7403825290670738; terminals('4', '2') = 0.9303705530587089; terminals('4', '3') = 0.443010471292977; 
terminals('5', '1') = 0.7500458612732138; terminals('5', '2') = 0.05123096643436986; terminals('5', '3') = 0.8254720777522382; 
terminals('6', '1') = 0.13929664949573572; terminals('6', '2') = 0.8309957395142517; terminals('6', '3') = 0.490381839685026; 
terminals('7', '1') = 0.9482437155267818; terminals('7', '2') = 0.6799569226841959; terminals('7', '3') = 0.4810756992096671; 
terminals('8', '1') = 0.1280459539063783; terminals('8', '2') = 0.05627087582821555; terminals('8', '3') = 0.8008509139773977; 
terminals('9', '1') = 0.5684930011546508; terminals('9', '2') = 0.2054757833186388; terminals('9', '3') = 0.2719393871237721; 
terminals('10', '1') = 0.6234261217107868; terminals('10', '2') = 0.4941338856636458; terminals('10', '3') = 0.5380674122270989; 
terminals('11', '1') = 0.5519722103731205; terminals('11', '2') = 0.8549714356002184; terminals('11', '3') = 0.028458309564846185; 
terminals('12', '1') = 0.8638877701583263; terminals('12', '2') = 0.6436838034162613; terminals('12', '3') = 0.9634321887537777; 
terminals('13', '1') = 0.17042566258952685; terminals('13', '2') = 0.03451759197876536; terminals('13', '3') = 0.2985681999181107; 
terminals('14', '1') = 0.19882263076674977; terminals('14', '2') = 0.5577961945758237; terminals('14', '3') = 0.2888851770670501; 
terminals('15', '1') = 0.017880199582456124; terminals('15', '2') = 0.27099245757608237; terminals('15', '3') = 0.942819930937753; 
terminals('16', '1') = 0.9458100535014008; terminals('16', '2') = 0.6674912032560051; terminals('16', '3') = 0.2932528462582392; 
terminals('17', '1') = 0.13152948076244697; terminals('17', '2') = 0.8301350684259818; terminals('17', '3') = 0.12464557243620955; 
terminals('18', '1') = 0.2690088075600472; terminals('18', '2') = 0.5755261901742839; terminals('18', '3') = 0.16984783313576257; 
terminals('19', '1') = 0.453416149173998; terminals('19', '2') = 0.06625132314538973; terminals('19', '3') = 0.35406827130560725; 
terminals('20', '1') = 0.7808973964696673; terminals('20', '2') = 0.857825414633251; terminals('20', '3') = 0.8243378432522797; 
terminals('21', '1') = 0.6619753029252616; terminals('21', '2') = 0.9788709284940017; terminals('21', '3') = 0.09603213504977959; 
terminals('22', '1') = 0.17891535148649085; terminals('22', '2') = 0.2713482653131719; terminals('22', '3') = 0.8285543302730931; 
terminals('23', '1') = 0.8236164621236046; terminals('23', '2') = 0.5767551562418222; terminals('23', '3') = 0.376403960605465; 
terminals('24', '1') = 0.36656002802151255; terminals('24', '2') = 0.9234638782715707; terminals('24', '3') = 0.601930280707767; 
terminals('25', '1') = 0.2033540256526868; terminals('25', '2') = 0.01739017601486237; terminals('25', '3') = 0.08558632758394435; 
terminals('26', '1') = 0.04799999656452236; terminals('26', '2') = 0.397381613695011; terminals('26', '3') = 0.2885017776351513; 
terminals('27', '1') = 0.6655701948690739; terminals('27', '2') = 0.02472142125738297; terminals('27', '3') = 0.3535303279640961; 
terminals('28', '1') = 0.18098855606484998; terminals('28', '2') = 0.9155459070962741; terminals('28', '3') = 0.7894861479428237; 
terminals('29', '1') = 0.5756728488474997; terminals('29', '2') = 0.9947420686249467; terminals('29', '3') = 0.29739928763870094; 
terminals('30', '1') = 0.8355060968239891; terminals('30', '2') = 0.24997627329586392; terminals('30', '3') = 0.9660268385563163; 
terminals('31', '1') = 0.47727235267179713; terminals('31', '2') = 0.8969687742392918; terminals('31', '3') = 0.6197185832215074; 
terminals('32', '1') = 0.14882627087884004; terminals('32', '2') = 0.7919031081317774; terminals('32', '3') = 0.2716425777259496; 
terminals('33', '1') = 0.4161690114230797; terminals('33', '2') = 0.6432181698588714; terminals('33', '3') = 0.9213623802744365; 
terminals('34', '1') = 0.19593919063512044; terminals('34', '2') = 0.3537493430803105; terminals('34', '3') = 0.16272839161297248; 
terminals('35', '1') = 0.9596912457926088; terminals('35', '2') = 0.665800196745978; terminals('35', '3') = 0.01401373560342034; 
terminals('36', '1') = 0.2738593868952296; terminals('36', '2') = 0.8865377798751257; terminals('36', '3') = 0.029817502777331084; 
terminals('37', '1') = 0.5537573927137771; terminals('37', '2') = 0.46824391197001647; terminals('37', '3') = 0.23500429697179803; 
terminals('38', '1') = 0.8670802764337553; terminals('38', '2') = 0.16106815181302714; terminals('38', '3') = 0.11387863544628851; 
terminals('39', '1') = 0.18123677747853006; terminals('39', '2') = 0.6474233460798013; terminals('39', '3') = 0.2721319137432773; 
terminals('40', '1') = 0.2915338707180093; terminals('40', '2') = 0.8881075168505114; terminals('40', '3') = 0.6988597398232517; 
terminals('41', '1') = 0.8255066297821904; terminals('41', '2') = 0.15964623270520695; terminals('41', '3') = 0.10150814738993019; 
terminals('42', '1') = 0.07352676360690136; terminals('42', '2') = 0.4519002620744016; terminals('42', '3') = 0.3348068297948825; 
terminals('43', '1') = 0.48622911200343544; terminals('43', '2') = 0.4595504260657328; terminals('43', '3') = 0.6928294008900446; 
terminals('44', '1') = 0.3755601396524457; terminals('44', '2') = 0.2551984160798203; terminals('44', '3') = 0.08106173139490103; 
terminals('45', '1') = 0.8236286176406902; terminals('45', '2') = 0.8963601030464248; terminals('45', '3') = 0.3197270637250039; 
terminals('46', '1') = 0.09120368738080575; terminals('46', '2') = 0.4268456572333442; terminals('46', '3') = 0.42445742808797304; 
terminals('47', '1') = 0.6347796722915025; terminals('47', '2') = 0.11614414783586713; terminals('47', '3') = 0.20126125866655198; 
terminals('48', '1') = 0.2172661235874399; terminals('48', '2') = 0.557642089763955; terminals('48', '3') = 0.1990958080205436; 
terminals('49', '1') = 0.43769336645902857; terminals('49', '2') = 0.6249901205244618; terminals('49', '3') = 0.9990914119414832; 
terminals('50', '1') = 0.1346617494318959; terminals('50', '2') = 0.1526181882800487; terminals('50', '3') = 0.8369607105275847; 
Parameter bigM / 1.7320508075688772 /;
Positive Variables distance_Steiner_Steiner(i,ii), distance_Steiner_terminal(i,j), Steiner_points(i,k);
Steiner_points.up(i,k) = 1; distance_Steiner_Steiner.up(i,ii) = bigM; distance_Steiner_terminal.up(i,j) = bigM;
Binary Variables is_connected_Steiner_Steiner(i,ii), is_connected_Steiner_terminal(i,j);
Variable objective;
Equations objective_definition, distance_Steiner_Steiner_def(i,ii), distance_Steiner_terminal_def(i,j), assignment(j), cardinality(i), Steiner_connectivity(i);
objective_definition.. objective =e= sum(i, sum(ii$(ord(i)<ord(ii)), distance_Steiner_Steiner(i,ii)) + sum(j, distance_Steiner_terminal(i,j)));
distance_Steiner_Steiner_def(i,ii)$(ord(i)<ord(ii)).. distance_Steiner_Steiner(i,ii) =g= sqrt(sum(k, power(Steiner_points(i,k) - Steiner_points(ii,k), 2))) - bigM * (1 - is_connected_Steiner_Steiner(i,ii));
distance_Steiner_terminal_def(i,j).. distance_Steiner_terminal(i,j) =g= sqrt(sum(k, power(Steiner_points(i,k) - terminals(j,k), 2))) - bigM * (1 - is_connected_Steiner_terminal(i,j));
assignment(j).. sum(i, is_connected_Steiner_terminal(i,j)) =e= 1;
cardinality(i).. sum(j, is_connected_Steiner_terminal(i,j)) + sum(ii$(ord(ii)<ord(i)), is_connected_Steiner_Steiner(ii,i)) + sum(ii$(ord(i)<ord(ii)), is_connected_Steiner_Steiner(i,ii)) =e= 3;
Steiner_connectivity(i)$(ord(i)>1).. sum(ii$(ord(ii)<ord(i)), is_connected_Steiner_Steiner(ii,i)) =e= 1;
Model m / all /;
Solve m using minlp minimizing objective;
