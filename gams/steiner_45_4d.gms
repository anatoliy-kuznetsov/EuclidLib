Sets
i Steiner points / 1*43 /
j terminals / 1*45 /
k dimensions / 1*4 /;
Alias(i,ii);
Parameters terminals(j,k);
terminals('1', '1') = 0.1442398062349004; terminals('1', '2') = 0.6743796915663622; terminals('1', '3') = 0.6184743588033738; terminals('1', '4') = 0.1220063313283486; 
terminals('2', '1') = 0.5061811093211224; terminals('2', '2') = 0.24665679484327752; terminals('2', '3') = 0.036782951175652; terminals('2', '4') = 0.119885891719272; 
terminals('3', '1') = 0.650874465928621; terminals('3', '2') = 0.13463133717962317; terminals('3', '3') = 0.11104027848388565; terminals('3', '4') = 0.1825510029159393; 
terminals('4', '1') = 0.40655201318448586; terminals('4', '2') = 0.47402653586050236; terminals('4', '3') = 0.6518669127155561; terminals('4', '4') = 0.7598682995865912; 
terminals('5', '1') = 0.1198945438095701; terminals('5', '2') = 0.3330843450711083; terminals('5', '3') = 0.7825320380475503; terminals('5', '4') = 0.05992382647898975; 
terminals('6', '1') = 0.030420656522411993; terminals('6', '2') = 0.6187235956260384; terminals('6', '3') = 0.8883160110014804; terminals('6', '4') = 0.7888497021004978; 
terminals('7', '1') = 0.5053410571739471; terminals('7', '2') = 0.5632592841151078; terminals('7', '3') = 0.4286583802246233; terminals('7', '4') = 0.3014371514392524; 
terminals('8', '1') = 0.08010331558408634; terminals('8', '2') = 0.36145025318737867; terminals('8', '3') = 0.2201805580103886; terminals('8', '4') = 0.3478205877881838; 
terminals('9', '1') = 0.8023239522563237; terminals('9', '2') = 0.7007958473929129; terminals('9', '3') = 0.23723197702037613; terminals('9', '4') = 0.971164011739421; 
terminals('10', '1') = 0.03219727599212807; terminals('10', '2') = 0.6924571969873756; terminals('10', '3') = 0.6711073028058617; terminals('10', '4') = 0.9134216860782335; 
terminals('11', '1') = 0.39698892802437513; terminals('11', '2') = 0.21133836996012323; terminals('11', '3') = 0.3750166586503597; terminals('11', '4') = 0.3092916339419517; 
terminals('12', '1') = 0.3177643816060316; terminals('12', '2') = 0.482215892868034; terminals('12', '3') = 0.8972166615702788; terminals('12', '4') = 0.898974932859378; 
terminals('13', '1') = 0.5484854985283085; terminals('13', '2') = 0.29222751369855915; terminals('13', '3') = 0.7221508075170611; terminals('13', '4') = 0.9752758763926134; 
terminals('14', '1') = 0.2692245398784954; terminals('14', '2') = 0.10021369480209563; terminals('14', '3') = 0.4807131155107035; terminals('14', '4') = 0.973005510838873; 
terminals('15', '1') = 0.7064791118646166; terminals('15', '2') = 0.349421812768677; terminals('15', '3') = 0.31125515577477314; terminals('15', '4') = 0.7339698411178349; 
terminals('16', '1') = 0.1977271112027993; terminals('16', '2') = 0.8657943239227665; terminals('16', '3') = 0.033505957195212654; terminals('16', '4') = 0.6506819082294457; 
terminals('17', '1') = 0.7457190647913569; terminals('17', '2') = 0.630832713854035; terminals('17', '3') = 0.8922981940724012; terminals('17', '4') = 0.07709358199322547; 
terminals('18', '1') = 0.8876248818297836; terminals('18', '2') = 0.06464028010539824; terminals('18', '3') = 0.8736840598494579; terminals('18', '4') = 0.841997006731721; 
terminals('19', '1') = 0.06832310554292942; terminals('19', '2') = 0.9385548205162542; terminals('19', '3') = 0.4722770126554201; terminals('19', '4') = 0.4156659043206209; 
terminals('20', '1') = 0.5395421565051021; terminals('20', '2') = 0.07494281913063483; terminals('20', '3') = 0.9109629465868376; terminals('20', '4') = 0.8111930550840454; 
terminals('21', '1') = 0.8336860179475153; terminals('21', '2') = 0.04584707989973247; terminals('21', '3') = 0.27910138834681; terminals('21', '4') = 0.5293064275578723; 
terminals('22', '1') = 0.3998693012168594; terminals('22', '2') = 0.33680561199944326; terminals('22', '3') = 0.5822795643665291; terminals('22', '4') = 0.40772744374435377; 
terminals('23', '1') = 0.2324063280461136; terminals('23', '2') = 0.1039239171323546; terminals('23', '3') = 0.23449702771540615; terminals('23', '4') = 0.667474517864238; 
terminals('24', '1') = 0.294047300177693; terminals('24', '2') = 0.9435388764018328; terminals('24', '3') = 0.3530563267346857; terminals('24', '4') = 0.8792077596749136; 
terminals('25', '1') = 0.6021026011737127; terminals('25', '2') = 0.3500931216834591; terminals('25', '3') = 0.743225811736358; terminals('25', '4') = 0.34232556330915653; 
terminals('26', '1') = 0.2773100355856225; terminals('26', '2') = 0.845046421680641; terminals('26', '3') = 0.03927897075075337; terminals('26', '4') = 0.9458479051727855; 
terminals('27', '1') = 0.4864734700241429; terminals('27', '2') = 0.51847342698024; terminals('27', '3') = 0.6505801780957398; terminals('27', '4') = 0.5102845143213532; 
terminals('28', '1') = 0.026543851462299317; terminals('28', '2') = 0.16345511007892188; terminals('28', '3') = 0.8635240252632209; terminals('28', '4') = 0.5421748141292382; 
terminals('29', '1') = 0.7730499660546615; terminals('29', '2') = 0.9478681833668114; terminals('29', '3') = 0.3532500144306734; terminals('29', '4') = 0.5285117172150805; 
terminals('30', '1') = 0.5750128928900266; terminals('30', '2') = 0.7481986030627655; terminals('30', '3') = 0.01401368494330213; terminals('30', '4') = 0.8117540078530919; 
terminals('31', '1') = 0.4962307245837898; terminals('31', '2') = 0.45435610997563025; terminals('31', '3') = 0.10236222965491837; terminals('31', '4') = 0.6423639681859871; 
terminals('32', '1') = 0.05590160218430329; terminals('32', '2') = 0.38355529013254186; terminals('32', '3') = 0.173368001077712; terminals('32', '4') = 0.41434556363343056; 
terminals('33', '1') = 0.4197487072774493; terminals('33', '2') = 0.000813821558415917; terminals('33', '3') = 0.339666606107793; terminals('33', '4') = 0.6070186006803107; 
terminals('34', '1') = 0.8571293788849519; terminals('34', '2') = 0.5033964895537478; terminals('34', '3') = 0.7183434489033711; terminals('34', '4') = 0.39958018662010175; 
terminals('35', '1') = 0.5794425784193763; terminals('35', '2') = 0.0970195592219345; terminals('35', '3') = 0.08615443394240141; terminals('35', '4') = 0.9449422573517389; 
terminals('36', '1') = 0.5229060557252869; terminals('36', '2') = 0.17932346322774384; terminals('36', '3') = 0.5847981667341494; terminals('36', '4') = 0.2771989186904589; 
terminals('37', '1') = 0.9511703006934721; terminals('37', '2') = 0.9035340391071942; terminals('37', '3') = 0.7339123087570479; terminals('37', '4') = 0.3417873609258303; 
terminals('38', '1') = 0.8479550855742911; terminals('38', '2') = 0.3408825095460819; terminals('38', '3') = 0.04827466636479205; terminals('38', '4') = 0.637258259366586; 
terminals('39', '1') = 0.6242947596984667; terminals('39', '2') = 0.8818523186077479; terminals('39', '3') = 0.4510756882014978; terminals('39', '4') = 0.41935786470320346; 
terminals('40', '1') = 0.6948704888541865; terminals('40', '2') = 0.5560285863925699; terminals('40', '3') = 0.2407933824289442; terminals('40', '4') = 0.260551393543038; 
terminals('41', '1') = 0.541892204765905; terminals('41', '2') = 0.28726167964347316; terminals('41', '3') = 0.08950413977832106; terminals('41', '4') = 0.4851468814273635; 
terminals('42', '1') = 0.47901417716633343; terminals('42', '2') = 0.17294000127614662; terminals('42', '3') = 0.8009224894907696; terminals('42', '4') = 0.6110880142738929; 
terminals('43', '1') = 0.5604623205735171; terminals('43', '2') = 0.9083459585145899; terminals('43', '3') = 0.8619066805994761; terminals('43', '4') = 0.6700187370307155; 
terminals('44', '1') = 0.10192927825246278; terminals('44', '2') = 0.38674226663471145; terminals('44', '3') = 0.3835985017624358; terminals('44', '4') = 0.5938698223247899; 
terminals('45', '1') = 0.3621904589201399; terminals('45', '2') = 0.9125340115481283; terminals('45', '3') = 0.43864961176624173; terminals('45', '4') = 0.4274096898852777; 
Parameter bigM / 2.0 /;
Positive Variables distance_Steiner_Steiner(i,ii), distance_Steiner_terminal(i,j), Steiner_points(i,k);
Steiner_points.up(i,k) = 1; distance_Steiner_Steiner.up(i,ii) = bigM; distance_Steiner_terminal.up(i,j) = bigM;
Binary Variables is_connected_Steiner_Steiner(i,ii), is_connected_Steiner_terminal(i,j);
Variable objective;
Equations objective_definition, distance_Steiner_Steiner_def(i,ii), distance_Steiner_terminal_def(i,j), assignment(j), cardinality(i), Steiner_connectivity(i);
objective_definition.. objective =e= sum(i, sum(ii$(ord(i)<ord(ii)), distance_Steiner_Steiner(i,ii)) + sum(j, distance_Steiner_terminal(i,j)));
distance_Steiner_Steiner_def(i,ii)$(ord(i)<ord(ii)).. distance_Steiner_Steiner(i,ii) =g= sqrt(sum(k, power(Steiner_points(i,k) - Steiner_points(ii,k), 2))) - bigM * (1 - is_connected_Steiner_Steiner(i,ii));
distance_Steiner_terminal_def(i,j).. distance_Steiner_terminal(i,j) =g= sqrt(sum(k, power(Steiner_points(i,k) - terminals(j,k), 2))) - bigM * (1 - is_connected_Steiner_terminal(i,j));
assignment(j).. sum(i, is_connected_Steiner_terminal(i,j)) =e= 1;
cardinality(i).. sum(j, is_connected_Steiner_terminal(i,j)) + sum(ii$(ord(ii)<ord(i)), is_connected_Steiner_Steiner(ii,i)) + sum(ii$(ord(i)<ord(ii)), is_connected_Steiner_Steiner(i,ii)) =e= 3;
Steiner_connectivity(i)$(ord(i)>1).. sum(ii$(ord(ii)<ord(i)), is_connected_Steiner_Steiner(ii,i)) =e= 1;
Model m / all /;
Solve m using minlp minimizing objective;
