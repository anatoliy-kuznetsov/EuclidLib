Sets
i Steiner points / 1*53 /
j terminals / 1*55 /
k dimensions / 1*3 /;
Alias(i,ii);
Parameters terminals(j,k);
terminals('1', '1') = 0.016825005872407095; terminals('1', '2') = 0.9618266054820354; terminals('1', '3') = 0.8915689917656648; 
terminals('2', '1') = 0.07420175145332009; terminals('2', '2') = 0.2339859078801907; terminals('2', '3') = 0.1758391144069249; 
terminals('3', '1') = 0.8932458749586821; terminals('3', '2') = 0.6730730973016164; terminals('3', '3') = 0.3154244019172018; 
terminals('4', '1') = 0.48398768755093835; terminals('4', '2') = 0.7870633159445551; terminals('4', '3') = 0.19842737217929418; 
terminals('5', '1') = 0.6744421602559135; terminals('5', '2') = 0.7979990444067284; terminals('5', '3') = 0.12689690743415927; 
terminals('6', '1') = 0.8202628342105195; terminals('6', '2') = 0.9651849300241607; terminals('6', '3') = 0.051568125642724505; 
terminals('7', '1') = 0.4298486408629313; terminals('7', '2') = 0.5257045282224386; terminals('7', '3') = 0.6320180017039196; 
terminals('8', '1') = 0.1028299963338758; terminals('8', '2') = 0.6615317516812519; terminals('8', '3') = 0.8843225872965885; 
terminals('9', '1') = 0.605991903154743; terminals('9', '2') = 0.2653317422591428; terminals('9', '3') = 0.149582255820918; 
terminals('10', '1') = 0.2788872339339834; terminals('10', '2') = 0.8357059651227867; terminals('10', '3') = 0.9314498915472966; 
terminals('11', '1') = 0.18529135220171822; terminals('11', '2') = 0.9052268531722542; terminals('11', '3') = 0.6087928769132401; 
terminals('12', '1') = 0.20964092815307367; terminals('12', '2') = 0.3754572952244537; terminals('12', '3') = 0.14916486070601864; 
terminals('13', '1') = 0.39417585976244296; terminals('13', '2') = 0.11772514622888852; terminals('13', '3') = 0.5518477538538149; 
terminals('14', '1') = 0.9069871853241732; terminals('14', '2') = 0.04066192191524842; terminals('14', '3') = 0.17695152244992718; 
terminals('15', '1') = 0.21853744633726624; terminals('15', '2') = 0.18897232250050278; terminals('15', '3') = 0.29827894791688647; 
terminals('16', '1') = 0.459871840562996; terminals('16', '2') = 0.5426403968521883; terminals('16', '3') = 0.5651490655071474; 
terminals('17', '1') = 0.638710481341321; terminals('17', '2') = 0.06342269614980367; terminals('17', '3') = 0.5969697103491904; 
terminals('18', '1') = 0.2783784799901995; terminals('18', '2') = 0.8367610651417221; terminals('18', '3') = 0.9737846585976002; 
terminals('19', '1') = 0.16600820978250674; terminals('19', '2') = 0.8254229107007699; terminals('19', '3') = 0.9349670172385942; 
terminals('20', '1') = 0.6983710940879191; terminals('20', '2') = 0.1615390740395921; terminals('20', '3') = 0.7803975801143284; 
terminals('21', '1') = 0.4023360471908084; terminals('21', '2') = 0.8382522787284553; terminals('21', '3') = 0.04874301182315133; 
terminals('22', '1') = 0.7504859345352792; terminals('22', '2') = 0.07747665786957658; terminals('22', '3') = 0.3902600513354533; 
terminals('23', '1') = 0.9643881066542385; terminals('23', '2') = 0.6074029964330321; terminals('23', '3') = 0.8941434090667653; 
terminals('24', '1') = 0.013629176277683563; terminals('24', '2') = 0.3031065824517958; terminals('24', '3') = 0.07455799196617985; 
terminals('25', '1') = 0.022835577554051634; terminals('25', '2') = 0.5329719841645676; terminals('25', '3') = 0.7343228728274795; 
terminals('26', '1') = 0.6326363924570437; terminals('26', '2') = 0.03966443136933473; terminals('26', '3') = 0.4773441376356432; 
terminals('27', '1') = 0.603105888063092; terminals('27', '2') = 0.2735639189356268; terminals('27', '3') = 0.288490988150384; 
terminals('28', '1') = 0.13255871344255443; terminals('28', '2') = 0.30268698757125156; terminals('28', '3') = 0.7530816474193546; 
terminals('29', '1') = 0.13370840419423258; terminals('29', '2') = 0.7375496490167703; terminals('29', '3') = 0.00348045534667063; 
terminals('30', '1') = 0.022807415699554356; terminals('30', '2') = 0.8197333092294194; terminals('30', '3') = 0.7897789186865609; 
terminals('31', '1') = 0.22038677184767608; terminals('31', '2') = 0.4240112080538009; terminals('31', '3') = 0.8170645732982585; 
terminals('32', '1') = 0.8172029812468086; terminals('32', '2') = 0.3728293782100368; terminals('32', '3') = 0.8201199286030796; 
terminals('33', '1') = 0.8876187931636013; terminals('33', '2') = 0.7457630496553465; terminals('33', '3') = 0.22736449635756195; 
terminals('34', '1') = 0.44759742977869343; terminals('34', '2') = 0.6791766647794575; terminals('34', '3') = 0.5415166158629453; 
terminals('35', '1') = 0.31234815244659964; terminals('35', '2') = 0.9506785577056175; terminals('35', '3') = 0.40412852110210773; 
terminals('36', '1') = 0.6389791719594511; terminals('36', '2') = 0.9935391011395844; terminals('36', '3') = 0.22577415901123332; 
terminals('37', '1') = 0.12054805124582424; terminals('37', '2') = 0.08046285525898311; terminals('37', '3') = 0.9360993410010429; 
terminals('38', '1') = 0.8243892793095055; terminals('38', '2') = 0.28254883893775773; terminals('38', '3') = 0.23646466903770147; 
terminals('39', '1') = 0.9213497179404434; terminals('39', '2') = 0.05686000859392659; terminals('39', '3') = 0.9651767953790604; 
terminals('40', '1') = 0.6695306184575474; terminals('40', '2') = 0.8281967869623659; terminals('40', '3') = 0.5201835270843331; 
terminals('41', '1') = 0.39210814501786984; terminals('41', '2') = 0.15752595628264843; terminals('41', '3') = 0.060506170259456926; 
terminals('42', '1') = 0.44650796975753027; terminals('42', '2') = 0.8547040861161932; terminals('42', '3') = 0.9179253696316632; 
terminals('43', '1') = 0.930543055073304; terminals('43', '2') = 0.42538374938487455; terminals('43', '3') = 0.8533470645596655; 
terminals('44', '1') = 0.4347634689785853; terminals('44', '2') = 0.4847975819351056; terminals('44', '3') = 0.11205575681690261; 
terminals('45', '1') = 0.895782744191105; terminals('45', '2') = 0.7067079665628473; terminals('45', '3') = 0.451253151599465; 
terminals('46', '1') = 0.7547935573794262; terminals('46', '2') = 0.3889660748510738; terminals('46', '3') = 0.7363146514015319; 
terminals('47', '1') = 0.7251811646111067; terminals('47', '2') = 0.4097394584487928; terminals('47', '3') = 0.24636946468707044; 
terminals('48', '1') = 0.48189497167022943; terminals('48', '2') = 0.7798539925240036; terminals('48', '3') = 0.4322092710134323; 
terminals('49', '1') = 0.7827685205405226; terminals('49', '2') = 0.5954170758606779; terminals('49', '3') = 0.10157424607866794; 
terminals('50', '1') = 0.22516137025856842; terminals('50', '2') = 0.6718574371947632; terminals('50', '3') = 0.5504881898428053; 
terminals('51', '1') = 0.8035257998964597; terminals('51', '2') = 0.3400258070282557; terminals('51', '3') = 0.23554911091828257; 
terminals('52', '1') = 0.9428761156433252; terminals('52', '2') = 0.9112176619824964; terminals('52', '3') = 0.673773310268036; 
terminals('53', '1') = 0.14750764550799855; terminals('53', '2') = 0.49407329619697693; terminals('53', '3') = 0.5853087845054387; 
terminals('54', '1') = 0.7677025118754208; terminals('54', '2') = 0.19086798693685159; terminals('54', '3') = 0.8137715754203186; 
terminals('55', '1') = 0.4027853231174412; terminals('55', '2') = 0.7501847997677608; terminals('55', '3') = 0.28505007111054204; 
Parameter bigM / 1.7320508075688772 /;
Positive Variables distance_Steiner_Steiner(i,ii), distance_Steiner_terminal(i,j), Steiner_points(i,k);
Steiner_points.up(i,k) = 1; distance_Steiner_Steiner.up(i,ii) = bigM; distance_Steiner_terminal.up(i,j) = bigM;
Binary Variables is_connected_Steiner_Steiner(i,ii), is_connected_Steiner_terminal(i,j);
Variable objective;
Equations objective_definition, distance_Steiner_Steiner_def(i,ii), distance_Steiner_terminal_def(i,j), assignment(j), cardinality(i), Steiner_connectivity(i);
objective_definition.. objective =e= sum(i, sum(ii$(ord(i)<ord(ii)), distance_Steiner_Steiner(i,ii)) + sum(j, distance_Steiner_terminal(i,j)));
distance_Steiner_Steiner_def(i,ii)$(ord(i)<ord(ii)).. distance_Steiner_Steiner(i,ii) =g= sqrt(sum(k, power(Steiner_points(i,k) - Steiner_points(ii,k), 2))) - bigM * (1 - is_connected_Steiner_Steiner(i,ii));
distance_Steiner_terminal_def(i,j).. distance_Steiner_terminal(i,j) =g= sqrt(sum(k, power(Steiner_points(i,k) - terminals(j,k), 2))) - bigM * (1 - is_connected_Steiner_terminal(i,j));
assignment(j).. sum(i, is_connected_Steiner_terminal(i,j)) =e= 1;
cardinality(i).. sum(j, is_connected_Steiner_terminal(i,j)) + sum(ii$(ord(ii)<ord(i)), is_connected_Steiner_Steiner(ii,i)) + sum(ii$(ord(i)<ord(ii)), is_connected_Steiner_Steiner(i,ii)) =e= 3;
Steiner_connectivity(i)$(ord(i)>1).. sum(ii$(ord(ii)<ord(i)), is_connected_Steiner_Steiner(ii,i)) =e= 1;
Model m / all /;
Solve m using minlp minimizing objective;
